import Head from "next/head";
import HomeProfile from "~/components/home/home-profile";
import Posts from "~/components/shared/post/posts";
import { api } from "~/utils/api";

export default function Home() {
  // const { data: posts, isLoading } = api.posts.getAll.useQuery(undefined, {
  //   staleTime: 18000,
  //   refetchOnWindowFocus: false,
  // });

  const postsData = api.posts.infinitePosts.useInfiniteQuery(
    {},
    {
      getNextPageParam: (lastPage) => lastPage.nextCursor,
      refetchOnWindowFocus: false,
    }
  );

  const posts = postsData.data?.pages.flatMap((page) => page.posts);

  return (
    <>
      <Head>
        <title>Threads</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="mx-auto flex min-h-screen max-w-4xl gap-16 px-4 md:ml-20 lg:ml-[34%] lg:p-0">
        <Posts
          posts={posts}
          isLoading={postsData.isLoading}
          fetchNewPosts={postsData.fetchNextPage}
          hasMore={postsData.hasNextPage}
        />
        <HomeProfile />
      </main>
    </>
  );
}
